<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>宾客座位规划（支持人数 | 实时协作）</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
<!-- 引入Font Awesome图标库 -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<style>
  :root{ 
    --bg:#0f1220; 
    --panel:#171b2c; 
    --accent:#6aa7ff; 
    --accent-2:#9f7bff; 
    --text:#e7ecff; 
    --muted:#9aa4c7; 
    --card:#1c2140; 
    --chip:#242a52; 
    --border:rgba(255,255,255,.08); 
    --cols:3; 
    --success:#4cd964;
    --warning:#ffcc00;
    --error:#ff3b30;
    --conflict-highlight: rgba(255, 59, 48, 0.15);
    /* 分类颜色 */
    --family:#4cd964;
    --friend:#ffcc00;
    --colleague:#6aa7ff;
    --other:#9f7bff;
  }
  *{box-sizing:border-box} 
  html,body{height:100%}
  body{ 
    margin:0; 
    background: radial-gradient(1200px 600px at 20% -10%, #1a2040 0, #0f1220 70%), var(--bg); 
    color:var(--text); 
    font:14px/1.4 system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial,"PingFang SC","Hiragino Sans GB","Microsoft YaHei",sans-serif; 
    display:flex; 
    gap:12px; 
    padding:12px; 
    overflow:hidden; 
  }
  .sidebar{ 
    width:320px; 
    min-width:260px; 
    max-width:380px; 
    background:var(--panel); 
    border:1px solid var(--border); 
    border-radius:16px; 
    padding:14px; 
    display:flex; 
    flex-direction:column; 
    gap:14px; 
    overflow:hidden;
  }
  
  /* 功能卡片样式 */
  .sidebar-section {
    background: var(--card);
    border-radius: 12px;
    padding: 12px;
    border: 1px solid var(--border);
    transition: all 0.2s;
  }
  
  .sidebar-section:hover {
    border-color: rgba(255,255,255,0.15);
  }
  
  h1{font-size:16px; margin:0 0 8px 0; letter-spacing:.5px; display:flex; align-items:center; gap:6px}
  h1 i {color: var(--accent);}
  
  .controls,.stats{display:grid; gap:8px}
  .controls input[type="text"], 
  .controls input[type="number"], 
  textarea, 
  input[type="file"]{ 
    width:100%; 
    padding:10px 12px; 
    border-radius:10px; 
    border:1px solid var(--border); 
    background:#0f1330; 
    color:var(--text); 
    outline:none; 
    transition:border-color 0.2s;
  }
  .controls input:focus, textarea:focus {
    border-color: var(--accent);
  }
  .row{display:flex; gap:8px; flex-wrap:wrap}
  .btn{ 
    appearance:none; 
    border:none; 
    cursor:pointer; 
    padding:10px 12px; 
    border-radius:10px; 
    color:white; 
    background:linear-gradient(135deg,var(--accent),var(--accent-2)); 
    box-shadow:0 6px 20px rgba(106,167,255,.25); 
    transition:.15s transform ease,.15s filter ease,.15s opacity ease; 
    white-space:nowrap; 
    display:flex;
    align-items:center;
  }

  .modal-backdrop.active .modal {
    transform: translateY(0);
  }
  .modal h2 {
    margin-top: 0;
    color: var(--text);
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .modal h2 i {
    color: var(--error);
  }
  .modal p {
    color: var(--muted);
  }
  .conflict-item {
    background: var(--conflict-highlight);
    border: 1px solid var(--error);
    border-radius: 8px;
    padding: 12px;
    margin: 8px 0;
  }
  .conflict-item.theirs {
    border-left: 4px solid var(--accent);
  }
  .conflict-item.mine {
    border-left: 4px solid var(--success);
  }
  .modal-buttons {
    display: flex;
    gap: 10px;
    justify-content: flex-end;
    margin-top: 20px;
  }
  
  /* 可视化统计 */
  .stats-chart-container {
    height: 200px;
    margin: 10px 0;
    position: relative;
  }
  
  /* 加载指示器 */
  .loading-indicator {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 1500;
    background: var(--panel);
    padding: 20px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    gap: 10px;
    border: 1px solid var(--border);
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
  }
  .loading-indicator.active {
    opacity: 1;
    pointer-events: all;
  }
  .loading-spinner {
    width: 20px;
    height: 20px;
    border: 3px solid rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    border-top-color: var(--accent);
    animation: spin 1s ease-in-out infinite;
  }
  
  /* 打印样式优化 */
  @media print {
    body {
      background: white;
      color: black;
      display: block;
      padding: 20px;
      overflow: visible;
    }
    .sidebar, .toolbar {
      display: none !important;
    }
    .main {
      width: 100%;
      display: block;
    }
    .canvas {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      padding: 0;
    }
    .table-card {
      background: white;
      border: 1px solid #ccc;
      color: black;
      page-break-inside: avoid;
    }
    .round {
      background: #f0f0f0;
      border-color: #ccc;
      color: black;
    }
    .chair {
      background: #f0f0f0;
      border-color: #ccc;
      color: black;
    }
    .chair.empty {
      display: flex;
      opacity: 0.6;
    }
    .table-footer {
      display: none;
    }
  }
  
  @media (max-width:920px){ 
    body{
      flex-direction:column; 
      overflow:auto; 
      padding:10px
    } 
    .sidebar{
      width:auto; 
      max-width:none;
      height: auto;
      max-height: 80vh;
    } 
    .canvas{
      grid-template-columns:repeat(1, minmax(260px,1fr))
    } 
  }

  @media (max-width: 600px) {
    .canvas {
      grid-template-columns: 1fr;
      padding: 8px;
    }
    .table-card {
      padding: 8px;
    }
    .round-wrap {
      width: 180px;
      height: 180px;
    }
    .round {
      width: 100px;
      height: 100px;
    }
  }
</style>
</head>
<body>
  <!-- 提示消息容器 -->
  <div class="toast-container" id="toastContainer"></div>
  
  <!-- 加载指示器 -->
  <div class="loading-indicator" id="loadingIndicator">
    <div class="loading-spinner"></div>
    <span id="loadingMessage">处理中...</span>
  </div>
  
  <!-- 冲突解决对话框 -->

      <button class="btn" id="shareBtn" role="button" aria-label="复制当前座位规划的分享链接">
        <i class="fas fa-share-alt"></i> 复制分享链接
      </button>
      <span class="pill">链接：<span id="shareTip" style="opacity:.85"></span></span>
      <span class="pill">计划ID：<code id="planIdLabel"></code></span>
      <span class="pill" id="onlineUsers">在线：0人</span>
    </div>

    <div id="canvas" class="canvas" aria-label="桌面画布"></div>
  </main>

  <!-- 引入外部JavaScript -->
  <script src="Seating-Plan.js"></script>
</body>
</html>
